# 感想
## DDD関連
### モデリング
+ 簡略化された決め打ち仕様のため、仕様の理解を進めてモデルを深めるという体験はしづらい
+ もう少しds層を書きたかった
  + 本で読んだ腐敗防止層や供給者等の外部との結合の経験値が得られない
+ メモリで完結している感が今までで一番出た
+ `UserRegistration`はずっともやっとしていた部分が書けた気がする
+ あー、`UserRegistration`ってドメインサービスなのかな！？
  + staticだし
+ `register`パッケージを育てている感覚

### 実装関連
+ 集約とリポジトリが1:1なのであれば、`SameUserValidationRepository`は不適切？
+ モデリング完了後の実装で、ほぼモデル修正無し
  + 方針で示した「モデリングの段階で脳内実装を行う」は大分慣れてきた
  + あったのは2-3箇所の引数過不足のみ
+ とはいえ、脳内実装しすぎなのだろうか
  + 複数人でここまでモデリングするのはやりすぎだと思う
  + あくまで訓練かと
+ 実装時にAPI -> Service -> Domainと、型が繋がる感覚
  + ドメインクラスの型、Eitherの型
  + むしろ実装は答え合わせくらいの感覚
  + 関数型の何かで聞いたフレーズ「設計はトップダウン、実装はボトムアップ」がとても理解できる

### ドメインロジック
+ 当然チェックにds層呼び出しは必要だが、参照結果をドメインで現すことでドメインに閉じることが出来た
  + 徹底して、ドメインクラスを受けてドメインクラスを返す
+ 判定処理をドメイン層に持ってこられた感がある

### 図
+ 申込直後は無料コースだと図で表すのが難しい
+ パッケージ大事って言ってた人がいたので、パッケージもちゃんと書く
+ パッケージをちゃんと書くとPlantUMLの可読性が著しく下がる気がする
+ 線を略しすぎると、VOのパッケージが明示できない
+ PlantUMLの保守性が気になる

### 参照
+ 未成年でも、同一人物の参照とクレカの参照を行ってしまう
  + けどそれはどうでも良いと言うスタンスに振り切ってみた

### テスト
+ コアドメインのテストがモック無く書けた感じが一番ある
+ 書いたテストが他のテストと棲み分けられてる感じがする
+ 大前提の通り、ドメイン層のテストは全て準備不要で可能
+ バリデはひとつだけ
+ 年齢チェック
+ クレカのエラーコードまわり
+ `UserRegistration`

### 失敗
+ 徹底して`Either`にした
+ 最初は`Boolean isValid(...)`程度に考えていたが、`UserRegistration`を作った辺りで専用ドメインクラスを用意して`Either`に変更
  + ドメインクラスに渡すのはドメインクラスにしたかった
+ とはいえ、全体的にはエラーはやり過ぎた感がある
  + エラーの切り口は要求とアウトパラ次第なとこもあるはず
  + `UserRegistrationInvalidReason`をどうしても作りたかったのに引きずられた感じがする
    + 失敗する可能性は3種なんだとenumerationしたかった
    + しかし`Reason --> Error <-- Message`は冗長感ある

## Scala関連
+ やはりReplは良い
+ そしてやはりEitherは良い
  + というかモナドまでないとあんまりどうでも...
+ enumは手抜きでjavaで
+ either.left.map.rightは冗長だなぁ
+ 関数渡しが楽だとDIが楽
+ ホントに`match-case`楽
  + 業務システムなんて条件連打なんし
  + 初めてScalaでパターンガード書いた

## 時間
+ 仕様まとめ、モデリング、Scala勉強で2時間弱
+ 実装で2時間強
+ 集中切れや休憩がのべ30分強

## 残り
+ 例によって登録で飽きた
+ とは言えなんとなくモデリング済み
  + 書いてて図が大きくなりすぎたのでごっそり捨てた
+ 参照は参照用ユーザを作る
+ 参照時のクレカは別クラスにする
  + マスクロジック
+ コース次第で課金or課金抹消を上手くドメインに書きたい
+ あとコースと料金の対応も

## 雑感
+ 副作用排除を徹底したのに時間がほぼ無かったなぁ
+ 「ドメインが振る舞う」というフレーズは未だしっくりこないけど、ロジックは漏れていない気がする
  + ServiceもApiも一切ロジック書いてないし
+ これだけ書いてみたけど、果たしてモデルは外部結合バグ出さないために、出してしまったときに、有用なのだろうか
